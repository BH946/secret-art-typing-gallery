# 연구노트

**이번에 처음 Thymeleaf 를 사용하다보니 해당 과정을 나중에 참고용으로 간략히 기록할 목적**

<br><br>

## 2023-08-11~12

**StudioController.java를 조져보도록 하자..! 이거하고나면 한동안 Spring공부로 빠지겠음.**

```java
추후에 손봐야하는 함수.
/**
* 작품 완성 화면
* 이때 생성한 "앨범(사진)" 데이터가 함께 넘어올것임. -> 추후 해결하자.
*/
@GetMapping("studioComplete") // URL 매핑(GET)
public String studioComplete() {
return "studio-complete"; // studio-complete.html 반환
}
```

**타임리프 표현식관련 조건문**

* `th:text="${(item!=null) ? item?.id+'전시실' : '?전시실'}"`
  * 이런식으로 `${}` 로 감싸야 하는 특징을 잘 기억해두고, `item?` 처럼 ?를 함께사용하면 더욱 null safe하게 개발할 수 있다.

**page를 url로 바꾸기도 힘들고 하니 간단히 넣어둬야겠음(부트스트랩써서)**

* Pagination 사용 -> 페이지 3개에 + ... 하나 넣어야겠음, 유동적으로 ...을 hidden으로 가리던지 등등 하겠음

* 페이징로직을 자바스크립트로 해결하기위해 Jquery도 사용하겠음

* **타임리프 문법 자바스크립트 사용가능 inline으로!! css도 마찬가지!**

  * ```html
    <script th:inline="javascript">
    var pageCount = /*[[${(totalCount/10)+1}]]*/ null; // 총 페이지 크기 -> 통신으로 받음
        // 물론, /**/ 주석을 제거해도됨. 단지 빨간줄 떠서 추가함.
        // 문법은 [[${}]] 형태로 작성하면 됨.
    ```

<br>

**마지막 제일 중요한 기능인 "폰트".. 변환... 할 차례.**

현재 받은 폰트 파일은 WOFF(웹폰트), OTF(오픈타입포맷)  

* WOFF로 바로적용 (단, 한글만 적용. 영어는 X)
* 결국 그림으로 저장되게 할건데.. 그림은 너비높이가 비율은 유지한체로 반응형웹으로 크기 자동 변경되게끔 보여주면 될것 같다.
* 따라서 처음 제작할때도 비율을 유지하는게 맡는것같아서 적당한 비율을.. 고민..흠..
  * 디자인 받은건 1280x520 이었으니 이것을 비율로 바꿔서 고정하면 될것같네.(1:2.4)
  * 비율 고정하는건 간단히 하나의 값(예로vw)을 사용하면 됨. 
    * 1:2 -> 50vw:100vw
    * flex로 0.98:0.02 처럼 비율로 두개 나눴을때 한쪽이커져서 덮어씌어질경우 max-width:92% 이런식으로 지정해서 해결
* **폰트 입력은 성공했고, 뭐... 배경색이나 이런건 금방할테니.. 이후 이미지로 저장하는거만 하면**
* **기능아예 끝임.**



<br><br>

## 2023-08-10

**아래 산으로 빠진 내용을 보고 gallery.html, product_detail.html이나 제대로 구현해보자.**

**잠깐만 산으로 빠져보자... ㅎㅎ 자꾸 이 캐시를 사용해서 최적화 하는게 마음에걸려서 ㅜ**

* 1000개정도 게시물이 있으면 1page에 10개씩 보여줌으로써 100page로 홈페이지 구성될거라 예상

  * 이 경우 캐시 사용시 오히려 캐시 메모리 사용량과 캐시 갱신에 많은 오버헤드 우려
  * **대신 페이지별로 캐싱을 권장**
    * DB접근때 페이징하는거랑도 관계가 좋아보임ㅇㅇ

* 매번 페이지별로(?page=1) url 접근하면 해당 페이지별로 데이터를 가져올거고(예로 데이터 10개) 이 데이터 처음가져올땐 캐시메모리에 기록하고 이후부터 메모리에서 빠르게 가져오기.

  * 그럼 page를 하나하나 100개 전부 접근하면 결국 1000개 데이터가 전부 캐시메모리에 기록되고, 오버헤드가 우려되지 않는가???
    * **오래된 캐시를 제거하는 등의 방법으로 해결**
    * 또한, 애초에 그런 접근은 악의적인 접근으로써 따로 보안로직을 구현해야한다고 생각
  * 그럼 게시물이 삭제되거나 수정되면?? 특히 삭제되면 페이지별 데이터 10개 구성한것도 9개가 되고 갱신도 되어야할거고 그럴텐데 이건 어떻게 해결할건데??
    * 게시물 삭제 시 캐시 업데이트 진행. **이때 삭제된 게시물 id로 해당 캐시를 무효화 하면 됨.**
    * 왜냐하면, 무효화 함으로써 캐시가 없기때문에 해당페이지 접근하는 사용자가있으면 새로 DB에 데이터를 불러올거기 때문. 또한, 불러와서 캐시에도 새롭게 기록될거임.
    * 특히, **이때 페이지별로 나눈 캐시를 사용**한 경우면, 해당 게시물이 속한 페이지의 캐시만 갱신하면 되는것. 모든페이지가 아니라.

* 마지막으로 페이지 당 게시물수 10개 고정일때 삭제되어도 다음페이지의 게시물로 채우는 방안

  * `SELECT * FROM 테이블명 ORDERS LIMIT 숫자(A) OFFSET 숫자(B)` 와 같이 limit, offset을 활용합니다.

    * 위 쿼리는 (**B+1**) 행 부터 **A** 행 만큼 출력을 합니다.
    * 예를 들어, `LIMIT 10 OFFSET 20`이면 21번째부터 30번째까지의 데이터를 가져오게 됩니다.
    * **단, JPQL에서는 limit, offset 키워드를 사용하지않고 setFirstResult(), setMaxResults() 를 사용해야 합니다.**

  * 이때, 스프링에서 제공하는 Pageable 클래스가있는데 아래코드처럼 작성해서 위 페이징하는 효과를 나타내게 도와주는 로직도 존재

    ```java
    public Page<Post> getPostsByPage(int pageNumber, int pageSize) {
        Pageable pageable = PageRequest.of(pageNumber - 1, pageSize);
        return postRepository.findAll(pageable);
    }
    ```

* 찐 마지막으로 캐시 메모리에 데이터도 제한이 가능한가??

  * ㅇㅇ 가능하다. 예를들면

    ```properties
    # application.properties
    spring.cache.cache-names=posts
    spring.cache.caffeine.spec=maximumSize=100 # 캐시 사이즈 설정 (예시로 최대 100개의 페이지를 캐시로 관리)
    ```

<br>

**페이징별 캐싱, 페이징 등등 수행완료.**

**참고로 마지막 최적화는 "예외처리 페이지" 진행할거임 ㅇㅇ**

gallery-item에서 "수정" 버튼은 비번입력후 studio-complete쪽으로 이동으로 보내는것으로 바꿨음

**낼부턴 StudioController.java 남았다고 볼 수 있:음.**

<br><br>

## 2023-08-08~09

**금일부터는 기능개발을 주로 할거기 때문에 Thymeleaf와 Spring을 위주로 정리**

**기능은 우선 네비게이터 먼저 적용(페이지간 이동먼저. 이후 페이지 하나씩 정해서 상세기능구현)**

**Thymeleaf**

* **attr 문법을 이용하면 속성들 전부 th로 적용할 수 있음!! good**

  * `href="gallery.html" th:attr="href=gallery"`
  * 단, 링크를 `@{/gallery}` 이런 형태로 줘야 함. 위와같은 형태는 현재url에 계속 추가로 쌓이므로 문제가 발생할 수 있음

* 자동완성?? https://stackoverflow.com/questions/54155605/spring-tool-suite-autocomplete-content-assist-not-working-no-proposal-kinds/65047344#65047344

  * 귀찮아서 아직 보진않음

* **약간 items->item으로 여러개 ui형성해야하는?? 그런것도 fragments로 빼두면 훨씬 개발하기 편할듯 싶어서 gallery-item.html으로 하나 구상해야겠음.**

* **if문은 삼항연산으로 간단히 가능하며, for문은 th:each문을 활용하면 됨**

* 표현식을 정확휴ㅏ게 잘 사용할 것

  * 예로 `th:text="'No.'+${item.id}"` 이런식으로 작성해야함.
  * 또 `th:href="@{gallery/productDetail/(id=${item.id})}"` 이런식으로 여기선 또 `()` 로 감싸서 이렇게쓰면 url의 ?id=값 이런 파라미터로 넘어가는것.
  * 그냥 url에 이어쓰듯이 하는건` th:href="@{gallery/productDetail/{id}(id=${item.id})}"` 이렇게 하면 파라미터가 아니라 해당 값이 {id} 이쪽으로 적용되는것

* 그저 링크 이동을 하고싶은거면 즉, href를 쓸거면 <button이 아닌 <a태그 사용할 것.

  * button은 from데이터 넘긴다던지 이런용으로 보통 사용. -> form의 action으로 넘어가기 때문

* **꿀TIP!!! 웹 개발중인데 Thymeleaf 적용을 보려면 항상 Spring을 껏다 켜야한다. 이런 reload를 굉장히 간단히 하는설정이 존재!!**

  * thymeleaf의 캐시를 사용안하면됨. 이렇게하면 웹에서 새로고침하면 바로바로 변경사항 적용 -> 물론 개발때만 이렇게하고 배포할때는 캐시 사용하게 바꿔줘야합니다

  * ```yml
    spring:
      thymeleaf:
        cache: false
        prefix: file:src/main/resources/templates/
    ```

**Spring**

* `Model` 클래스 활용 -> view에 데이터 보내서 간편히 보여줄 수 있는 클래스

* @RequestParam : 기존 url 쿼리 파라미터 방식 : ?userId=userA

* **@PathVariable("itemId") : 최신 트랜드인 경로 변수 방식 : /mapping/userA**

  - 중요한점은 @PathVariable 로 매핑한 userA가 따로 Model을 활용하지 않아도,
  - 백엔드 뿐만 아니라 프론트에서도 userA값을 사용가능하단 점이다.
  - (이부분은 추측이지만, 자동으로 변수를 추가해서 같이 프론트로 반환되는게 아닐까)
    - 스프링의 Model 클래스는 브라우저의 쿠키처럼 프론트에 같이 넘어가는 클래스
    - 이 때문에 데이터를 주고받기 수월
  - **물론, 햇갈릴수도 있어서 그냥 Model을 항상 데이터 보내는 용도로 사용하고,**
  - **@PathVariable을 url로 받은 값을 사용하는 목적으로 활용하는게 젤 좋아보임.**

* ```
  return "redirect:/gallery"; // 웹 요청을 다시 하는것(따라서 해당 함수를 실행)
  return "gallery"; // 평소처럼 gallery.html을 반환
  ```

<br>

**참고로 현재 최적화 없이 그냥 하고있음. 리액트나 그런건 HTTP통신으로 값가져왔을때 따로 상태변수로 잘 저장해서 관리할텐데 지금 타임리프에서 하고있는건 이러 ㄴ"상태변수"없는것 같음. 여기서 느껴지는게 리액트(웹)였으면 Redux같은 기술을 활용했을거고 리네(앱)는 AsycnStorage 기술도 있고 방안이 다양한데, Thymeleaf는 확실히 SSR(서버사이드렌더링) 방식이다보니 서버쪽에서 해결하는게 맞는것 같다.**

* **최대한 이문제는 서버에서 해결해보겠ㅇㅁ(@Cacheable 이거 사용하면 될듯?)**
  * [잘 정리한 사이트](https://adjh54.tistory.com/m/165) -> 이거보면 사용법이 다양함.
  * 이부분에대해서 조금 알아보니 해결방안이 조금 보이는것 같다.
  * @Cacheable과 @CachePut 왼쪽꺼는 조회용, 오른쪽꺼는 저장용으로 사용하면 되며 "캐시"특성상 서버 메모리에 기록되는것이므로 @Cacheable로 조회하면 DB에 쿼리문을 날릴필요가 없이 자신의(서버) 메모리에서 값을 가져오면 되므로 훨씬 최적화가 된다고 생각한다.
    * 당연히 @Cacheable도 캐시에 저장하는데, 캐시에 값이 없을경우 저장한다는 특징이있고, @CachePut 은 값이 있어도 덮어씌운다고 생각하며 ㄴ된다.
  * 따라서 본인 생각에는 @CachePut을 게시물 **삭제, 수정, 추가** 이럴때에 추가로 적용해주고
  * 나머지 그냥 **조회**에는 @Cacheable을 다 적용하면 최적화가 될거라고 예상한다.
  * **적용후 결과는??**
    * `@EnableCaching` 꼭 이거를 해줘야 캐시 사용 선언을 하는것. 
      * 간단히 main함수쪽에 추가했음
    * `@Cacheable(value = "codeCache")` 이런식으로 value를 지정해줘야 '키'처럼 사용해서 식별할 수 있게 메모리에 저장할 수 있음.
    * **게시물 삭제, 수정, 추가에 @CachePut사용, 조회에 @Cacheable 사용함으로써 최적화 진행**

<br>

**우선은 기본적인 기능들을 다 구현하고 나면, 최적화 할 때 그 카페 전체게시물 보는것처럼 그부분은 보통 어떤식으로 구현해서 최적화를 하는지 알아둬야 할 듯 싶음.**

**이에관해서 아래내용으로 gpt에게 한번 의견을 물어보겠음.**

* 홈페이지에 전체게시물을 보면 페이지별로 나눠서 10개정도씩 게시물들이 등장한다.  
  만약 게시물이 1000개라고 한다면, 이 1000개를 캐시메모리에 전부 기록하는것은 용량을 많이 잡으니 별루라고 생각한다.  

* 따라서 게시물을 적당히 100개 정도씩 캐시메모리에 기록하는걸로 정하고, 이것을 @Cacheable을 사용해서 데이터를 출력하면된다고 생각한다.  
  여기서 데이터가 변경되었을경우엔 @CachePut을 사용해서 캐시메모리에 100개 데이터를 다시 기록해서 사용하면 된다고 생각한다.

* 내가 생각한 최적화는 이거인데 맞다고 생각하는가?
* **답변은**
  * .. 그냥 최적화는 나중에하자.
  * 굉장히 모르겠ㄸ



<br><br>

## 2023-08-07

**stuido.html 레이아웃 구성완료**

* 어느정도 노하우가 생기기 시작
* 나머지 html 레이아웃도 오늘 다 제작하는것을 목표로

**알림창같이 창하나 더 띄우는건 Modal 을 활용**

* **모달의 경우 html에서 footer보다도 밑인 하단에 작성하는것을 권장.**
* 만약 footer위에하면 모달안에 footer가 딸려들어오는 구조로 적용됨

`&times;` 는 "X" 표시이다. 즉, close 버튼의 경우 버튼 내에 텍스트로 이것이 입력된 구조가 많다.

* 실제로 부트스트랩도 이구조이므로 버튼 X의 크기를 변경하고싶으면 font-size를 변경해야한다.

비밀번호 입력받을때 서버에서도 입력조건 처리하겠지만 프론트단에서도 먼저 처리해주고 서버에서도 처리해주면 더욱 안전

* 따라서 프론트단에서 정규식 검사하는 js 문법 활용
* onkeypress 방식을 사용했는데 이방식은 복붙을 구별하진 못해서 서버단에서도 처리해주는게 더욱 안전하다는 것

다양한 레이아웃 구성을 해보았고, 막히는 부분이있으면 지금까지 만든 레이아웃 코드를보자.

* 충분히 지금까지 한 코드 활용하면 원하는 레이아웃 어느정도 가능하다 판단됨

**꿀팁 -> 텍스트 가로 유지 -> `white-space: nowrap;` 스타일 적용**

<br><br>

## 2023-08-06

**웹 폰트 SUIT를 사용중이라 이걸 css에 적용해보기**

* https://noonnu.cc/font_page/1150 로 css에서 적용 -> 지정한 font-family명으로 body에 font-family 속성에 적용
* `font-family: 'SUITE-Regular', sans-serif; ` 이렇게 적용함으로써 SUITE폰트 있으면 적용하고, 없으면 sans폰트 사용

**부트스트랩의 슬라이더를 사용하려면 Range 키워드 검색 -> 크기 커스텀은?**

* 크기 커스텀하는데 매우 많은 난항을 겪었다. 사실 크기를 고정했으면 전혀 문제가 없겠지만, 반응형으로 나타내기위 `vw, em` 을 사용하려고 노력했다.
* 특이사항으로 margin-top이 핸들에 적용이 되있는점을 확인했고, 이부분을 `vw, em` 을 적절히 활용해서 반응형에 맞게 수정했음
* 슬라이더 트랙이 "부모", 슬라이더 핸들이 "자식" 관계이므로 "자식" 에는 "부모" 의 비율에 맞게 반응형으로 사이즈 맞추기 위해 `em`을 활용했음.
  * **실제로 em은 "부모"의 font-size의 크기에 따라서 크기 결정됨**
  * **여기서 rem은?? -> em과 개념은 같은데 제일 root의 부모의 font-size를 따름**
  * **vw, vh는 뷰포트 화면(장치:예로 브라우저)크기에 따라 사이즈 결정됨**
  * **따라서 본인은 `vw, vh`로 "부모"부분 먼저 크기 결정후 `em`으로 "자식" 부분 크기 결정**
    * 여기서 꼭 부모부분에 font-size 안쓰더라도 크기 결정해줘 `em` 활용 가능

<br><br>

## 2023-08-05

**부트스트랩**

**아래 영상 참고해서 상단은 nav, 하단은 footer 를 사용할거임**

* **nav : https://www.youtube.com/watch?v=ox6_XCyJ9GY&list=PLRx0vPvlEmdAZ-wT8pwVJn5GBp5a5aVGy&index=3**
* **footer : https://www.youtube.com/watch?v=JH1UirUO1jA&list=PLRx0vPvlEmdAZ-wT8pwVJn5GBp5a5aVGy&index=6**
* 참고로 두가지의 경우 보통 좌우 꽉채우므로 `container-fluid` 사용도 괜찮음

**`flex:1` 를 이용해서 부피 확장하는것 참고(가끔 이걸로 해결됨)**

흠.. 자꾸 본문 전체를 하나의 컨테이너로 묶어서 개발하려고 했는데, 생각해보니... 보통 홈페이지는 내용이많으면 그만큼 스크롤바로 아래로 내려서 본다.

즉, 굳이 한화면에만 나타내려 할 필요가 없는것 같다. 따라서 본문에선 뷰 하나하나씩 차례로 아래로 쌓아가면서 만들어보겠다. 크기들을 최대한 잘 보이게끔 해서.

**참고로 `row` 에 margin 있기 때문에 필요없을땐 꼭 `m-0` 으로 직접 커스텀 필요**

<br>

**타임리프**

* `fragment + replace` 사용해서 nav, footer같은 반복해서 적는 부분들 재사용
  * 당연히 서버 실행해야 적용 - 타임리프 문법이기 때문

<br><br>

## 2023-08-04

본격적으로 웹페이지 레이아웃을 만들어 보겠다.

사용한 부트스트랩, 타임리프 관련 문법들은 기록해두려고 함.

**태그**

* 본문 보통 `<p>`, 본문 세부 스타일링은 `<span>`, 링크 연결(클릭 커서바뀌는) `<a>`

**부트스트랩**

* grid 방식(flex방식도 많이사용)으로 레이아웃 전체 틀을 구성하려함 -> **반응형 row, col**
  * row안에 `col-sm-2, col-sm-10` 처럼 총합 12가 gird의 한행의 끝을 의미
  * **즉, 한행은 12열로 이루어짐**
  * **`<div class="row text-center align-items-center">` 이런식으로 중앙정렬**
    * `text-center` : 텍스트 중앙 정렬(좌우)
    * `align-items-start,center,end` : items 정렬이므로 자신의 자식들 정렬
    * `align-self-start,center,end` : self 정렬이므로 자신이 정렬
    * **참고로 align... justify... 이것들 정렬은 flex에서 주로 사용하므로 flex에서 사용할것**
* **`<img class="img-fluid>` 로 반응형 img 가능, `fs-4` 등등은 반응형 text 가능**
  * **본인은 `fs-4` 도 좋지만 직접 `vw,vh,em` 같이 size를 적절히 많이 주는중**
  * **vw, vh, 50% 등등 반응형에 맞게끔**
* `<nav class="navbar navbar-expand-md">` 로 nav 요소를 열어줌(expand-sm 등등)
  * `<div class="collapse navbar-collapse" id="navbarNav">` 은 collapse로 한줄에 표시해주는 느낌에다가 화면작을때 햄버거형태로 보여주는 반응형.. -> 토글버튼...같이..
  * **`class=navbar` 가 padding이 있기 때문에 없애고 싶으면 padding:0을 style 지정**
    * **class에 p-0나 pt-0(위)...등등**
    * **또한, flex-direction도 row로 지정되어있어서** 필요시 column으로 변경가능
      * **간단히 class에 flex-column으로 지정 가능**
* **`bg-info, primary, secondary` 등등으로 백그라운드 컬러 간단히 테스트로 지정가능(개발하기에 용이)**
* `p-0, m-0` 등등으로 padding, margin 바로 적용 가능

* **반복되는것들만 css로 따로 적고 별거아닌건 인라인으로 바로 작성**

* **border은 항상 style을 solid라던지 스타일 지정을해줘야 적용이 되는듯**
  * 참고로 굵기는 꼭 width를 같이 붙여줄것

* img 태그의 경우 혼자쓰는 태그이므로 이곳에 postion-relative, absolute는 불가능하므로 이를 감싸는 상위 태그에 relative를 적용해서 사용하는것을 권장

<br><br>

## 2023-08-03

* 부트스트랩 : https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html#including-template-fragments
* 타임리프 : https://getbootstrap.com/docs/5.3/components/navbar/#toggler

보통 부트스트랩(css) + Thymeleaf 로 웹개발 진행  
**본인은 `부트스트랩(css) + 피그마(css) + Thymeleaf` 로 진행**

**Youtube자료(옛날꺼긴 함) + Thymeleaf 공문 자료 참고(문법 등등)**

MVC 패턴으로 API 개발은 이미 해봤기 때문에 웹 관련해서만 기록중 ..

<br>

VSCode가 html 형식을 더 잘 지원해준다고 해서 VSCode로 html은 개발

물론 서버로 실행은 Spring에서 실행 -> Ctrl+F5로 빠르게 reload

**먼저 피그마로 받은 웹페이지 9개?? 레이아웃 개발 진행 -> 기능은 나중에 개발**

* css는 static 폴더로 전부 빼두기
* **부트스트랩을 사용하는 이유는 반응형 웹을 간편히 정의하기 위해**
  * 부트스트랩은 수많은 것을 제공해준다. **예를들어, 폰트사이즈의 경우??**
    * font-size:100px; 이런식으로 작성시 100px로 글자가 "고정"
      * **따라서 원래 em, rem, vw, vh 같은 단위를 사용해줘야 한다.**
    * **그러나 부트스트랩의 경우??**
      * **fs-1, fs-2** 등등 글자 크기를 제공해주는데 이것을 사용하면 매끄럽게 **반응형 웹을 제공**한다.
    * 단, 직접 커스텀해야하는 부분들도 존재한다. **예를들어, flex의 경우??**
      * 기존엔 display: flex, flex:1 이런식으로 적용했는데, 부트스트랩에서는 display:flex는 제공하지만, flex:1이 없다.
      * 따라서 이런부분은 직접 css 커스텀을 해줘야 한다.
        * `<div class="d-flex custom-header-flex">` 커스텀 한 예시이다.
        * 뒤의 custom-header-flex 부분은 따로 css 선언을해서 flex:1을 적용한 방식
        * d-flex는 부트스트랩이 제공하는 display:flex를 의미
  * **여기서 결론은??**
    * **반응형 웹으로 개발을 위해 최대한 부트스트랩의 기능을 활용하고,**
    * **없는부분만 따로 css 로 커스텀 하자는것!**

<br><br>
